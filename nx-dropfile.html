<dom-module id="nx-dropfile">
    <style>
        .dropzone{
            background-color:#CCC;
        }
    </style>
    <template>
        <input id="dropSelect" type="file" id="input" multiple>
        <div id="dropzone" class="dropzone">
            dropfile
            <template is="dom-repeat" items="{{files}}">
              {{item.name}} // {{item.percent}}<br>
           </template>
        </div>
        <button on-tap="upload">upload</button>
    </template>
    <script>

        Polymer({
            is:'nx-dropfile',
            properties:{
                files:{
                    type:Object,
                    value:function(){
                        return [];
                    },
                    notify:true
                }
            },
            ready:function(){
                this.testza = this;
                var dropzone = this.$.dropzone;
                dropzone.ondragover = dropzone.ondragenter = function(event) {
                    event.stopPropagation();
                    event.preventDefault();
                }
                
                var rootDom = this;

                dropzone.ondrop = function(event){
                    event.stopPropagation();
                    event.preventDefault();
                    
                    var files = event.dataTransfer.files;
                    for (var i=0; i<files.length; i++) {
                        console.log(files[i]);
                        rootDom.push('files',files[i]);
                    }
                }

                

                this.$.dropSelect.onchange = function(){
                    var files = this.files;
                    for (var i = 0; i < files.length; i++) {
                        //console.log(files[i]);

                        //var r = new FileReader();
                        //r.onload = function(){ console.log(r.result); };
                        //r.readAsDataURL(files[i]);
                        //r.readAsBinaryString(files[i]);
                        //r.readAsArrayBuffer(files[i]);

                        rootDom.push('files',files[i]);
                    }
                }
                
            },
            upload:function(){

                this.files.map((fileItem,i)=>{
                
                    var data = new FormData();
                    data.append('file',fileItem);

                    var config = {
                        onUploadProgress: (progressEvent)=>{
                            var percentCompleted = progressEvent.loaded / progressEvent.total;
                            this.set(`files.${i}.percent`,percentCompleted);
                        }
                    };

                    axios.put('http://localhost:3000/api/eu/test/upload', data,config)
                    .then(function (res) {
                        console.log(res.data);
                    })
                    .catch(function (err) {
                        console.log(err.message);
                    });
                });
            }
        });

    </script>

</dom-module>